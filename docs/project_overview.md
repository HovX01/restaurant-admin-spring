# Restaurant Administration System – Project Overview

## Purpose and Scope
The Restaurant Administration System provides a unified backend for running restaurant operations. It centralizes authentication, menu management, ordering, delivery logistics, and real-time staff coordination behind a secure REST API. The service is intended to power internal dashboards or external clients that need programmatic control over restaurant workflows.

## System Capabilities
- **Identity & Access Management** – JWT authentication, password management, and role-driven authorization (ADMIN, MANAGER, KITCHEN_STAFF, DELIVERY_STAFF).
- **Menu Catalog** – CRUD management for categories and products, availability toggling, price/availability filtering, and pagination.
- **Order Lifecycle** – Creation, updates, status transitions, statistics, and kitchen visibility with validation for order items and totals.
- **Delivery Operations** – Assignment, driver tracking, status changes (pending → out for delivery → delivered), and driver availability endpoints.
- **Real-time Notifications** – STOMP/WebSocket broadcasting for global events, targeted role channels, and user-specific queues.
- **Consistent API Experience** – Standardized `ApiResponseDTO<T>` envelopes, centralized exception handling, and extensive endpoint documentation (see `docs/endpoint.md`).

## Architecture Overview
The codebase follows a layered Spring Boot structure:

1. **Controllers (`controller` package)** – Expose REST endpoints for authentication, users, categories, products, orders, deliveries, and WebSocket messaging.
2. **Services (`service` package)** – Orchestrate business logic, manage transactional boundaries, enforce domain rules, and trigger WebSocket broadcasts.
3. **Repositories (`repository` package)** – Spring Data JPA repositories that abstract PostgreSQL persistence using entities in the `entity` package.
4. **DTOs & Mapping (`dto` & `mapper` packages)** – Request/response transport objects and the `EntityMapper` that translates between entities and DTOs.
5. **Security (`config` & `security` packages)** – `SecurityConfig`, `JwtAuthenticationFilter`, and supporting classes for JWT verification, role-based access, and custom entry points.
6. **Configuration (`config` package)** – `SwaggerConfig`, `WebConfig`, and `WebSocketConfig` wire up OpenAPI docs, CORS, and STOMP brokers.
7. **Utilities & Cross-cutting Concerns** – `JwtUtil` for token operations and `GlobalExceptionHandler` for consistent error responses.

### Request Flow
```
HTTP Request → Controller → Service → Repository → Database
                               ↓
                           DTO Mapping
                               ↓
                         ApiResponseDTO
```
Real-time events originate in services and are dispatched through `WebSocketService` to `WebSocketController`, which publishes to `/topic/...` or `/user/...` destinations via `SimpMessagingTemplate`.

## Domain Model Snapshot
- **User** – Core identity with BCrypt-hashed passwords, roles, and timestamps.
- **Category & Product** – Hierarchical menu items with pricing, availability flags, and description metadata.
- **Order & OrderItem** – Orders capture customer details, totals (`BigDecimal`), type (`DINE_IN`, `TAKEOUT`, `DELIVERY`, `PICKUP`), and a status pipeline from `PENDING` to `COMPLETED/CANCELLED`.
- **Delivery** – One-to-one with Order, references a driver (`User`), tracks status (`PENDING`, `ASSIGNED`, `OUT_FOR_DELIVERY`, `DELIVERED`, `CANCELLED`), and records dispatch/delivery timestamps.

JPA annotations and lifecycle callbacks manage persistence details such as autogenerated IDs, timestamps (`@CreationTimestamp`), and relationship mappings.

## Security & Authentication
- **JWT Tokens** – Issued on successful login (`/api/auth/login`) and required for all `/api/**` endpoints except explicitly public routes.
- **Authorization Rules** – Method-level and route-level configuration ensures only the proper roles can perform privileged operations (e.g., only ADMIN/MANAGER can manage users).
- **Custom Handlers** – `CustomAuthEntryPoint` and the global exception handler transform security errors into consistent API responses.
- **Password Policies** – bcrypt hashing via Spring Security and dedicated password-change endpoints.

## Real-time Messaging
- **Endpoint:** `/ws`
- **App Destinations:** `/app/message`, `/app/order`, `/app/delivery`, `/app/private`
- **Broadcast Topics:** `/topic/orders`, `/topic/deliveries`, `/topic/notifications`, role-oriented topics (kitchen, delivery staff), and `/queue` destinations for user-specific messages.
- **Message Schema:** `WebSocketMessageDTO` encapsulates type identifiers (e.g., `ORDER_CREATED`, `DELIVERY_STATUS_UPDATED`), human-readable text, payload data (OrderDTO/DeliveryDTO), and timestamps.
- **Service Integration:** `OrderService` and `DeliveryService` invoke `WebSocketService` methods after state changes so clients receive timely updates.

## Development Workflow
- **Build & Run:** `./gradlew clean build` and `./gradlew bootRun`
- **Testing:** `./gradlew test`
- **Local Environment:** Java 17+, Gradle 7+, PostgreSQL 12+; configure DB credentials in `src/main/resources/application.properties`.
- **Documentation:** Swagger UI (`/swagger-ui.html`) for live API exploration and Markdown docs (`docs/endpoint.md`, `docs/project_context.md`) for reference.
- **Coding Guidelines:** Use DTO-based responses, favor service-level business logic, and keep controllers thin. Validation annotations enforce request correctness.

## Operational Considerations
- **Error Handling:** Centralized via `GlobalExceptionHandler` to return descriptive messages and appropriate HTTP statuses.
- **Data Integrity:** Validation annotations plus explicit checks in services (e.g., status transitions, driver assignments) prevent invalid states.
- **Extensibility:** Modular packages and clear DTO boundaries make it straightforward to add new resources or extend existing workflows (e.g., loyalty programs, kitchen metrics).

This overview should help new contributors grasp the system’s architecture, moving parts, and development conventions before diving into the code or the more granular endpoint documentation.
